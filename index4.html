import React, { useState, useEffect } from 'react';
import { Clock, Play, CheckCircle, XCircle, ArrowRight, ArrowLeft, RefreshCw, Zap, Award } from 'lucide-react';

// --- प्रश्न डेटा (Question Data) ---
const QUESTIONS = [
  {
    id: 1,
    question: "6 : 222 :: 7 : ?",
    options: ["343", "350", "336", "210"],
    correctAnswer: "350",
    logic: "Logic: n³ + n. (6³ + 6 = 222), इसी प्रकार (7³ + 7 = 350)."
  },
  {
    id: 2,
    question: "न्यूमिज़माटिक्स : सिक्के :: ? : पत्थर",
    options: ["ओरोलॉजी", "लिथोलॉजी", "पैलियोन्टोलॉजी", "इकोलॉजी"],
    correctAnswer: "लिथोलॉजी",
    logic: "सिक्कों के अध्ययन को न्यूमिज़माटिक्स कहते हैं, पत्थरों के अध्ययन को लिथोलॉजी कहते हैं।"
  },
  {
    id: 3,
    question: "123 : 36 :: 221 : ?",
    options: ["25", "52", "69", "72"],
    correctAnswer: "25",
    logic: "अंकों का योग और उसका वर्ग। (1+2+3)² = 36. (2+2+1)² = 25."
  },
  {
    id: 4,
    question: "CAT : 3120 :: MAT : ?",
    options: ["13120", "132620", "12120", "130120"],
    correctAnswer: "13120",
    logic: "C=3, A=1, T=20 -> 3120. M=13, A=1, T=20 -> 13120."
  },
  {
    id: 5,
    question: "ईरान : मजलिस :: बुल्गारिया : ?",
    options: ["डाइट्स", "स्टोर्टिंग", "नरोदनो सबरानी", "सोगडू"],
    correctAnswer: "नरोदनो सबरानी",
    logic: "देश और उनकी संसद। ईरान: मजलिस, बुल्गारिया: नरोदनो सबरानी।"
  },
  {
    id: 6,
    question: "48 : 122 :: 168 : ?",
    options: ["292", "290", "225", "215"],
    correctAnswer: "290",
    logic: "अभाज्य संख्याओं का वर्ग +/- 1. (7²-1) : (11²+1) :: (13²-1) : (17²+1)."
  },
  {
    id: 7,
    question: "ऊर्जा : जूल :: पास्कल : ?",
    options: ["दबाव (Pressure)", "शक्ति (Power)", "बल (Force)", "प्रतिरोध"],
    correctAnswer: "दबाव (Pressure)",
    logic: "जूल ऊर्जा की इकाई है, पास्कल दबाव की इकाई है।"
  },
  {
    id: 8,
    question: "FILM : ADGH :: MILK : ?",
    options: ["ADGF", "HDGF", "HEGF", "HDGE"],
    correctAnswer: "HDGF",
    logic: "हर अक्षर में -5 का अंतर है। M-5=H, I-5=D, L-5=G, K-5=F."
  },
  {
    id: 9,
    question: "5 : 100 :: 7 : ?",
    options: ["49", "196", "91", "149"],
    correctAnswer: "196",
    logic: "Logic: (n² × 4). 25×4=100. 49×4=196."
  },
  {
    id: 10,
    question: "अकादमिक : पेडागोगी :: धर्म : ?",
    options: ["धर्मशास्त्र", "मनोविज्ञान", "दर्शनशास्त्र", "समाजशास्त्र"],
    correctAnswer: "धर्मशास्त्र",
    logic: "अकादमिक अध्ययन: शिक्षाशास्त्र, धर्म का अध्ययन: धर्मशास्त्र।"
  },
  {
    id: 11,
    question: "B : 16 :: D : ?",
    options: ["64", "256", "128", "32"],
    correctAnswer: "256",
    logic: "स्थान का मान की घात 4. B=2, 2⁴=16. D=4, 4⁴=256."
  },
  {
    id: 12,
    question: "हृदय : कार्डियोलॉजिस्ट :: वृक्क (Kidney) : ?",
    options: ["न्यूरोलॉजिस्ट", "नेफ्रोलॉजिस्ट", "ऑर्थोडॉन्टिस्ट", "ओन्कोलॉजिस्ट"],
    correctAnswer: "नेफ्रोलॉजिस्ट",
    logic: "किडनी के डॉक्टर को नेफ्रोलॉजिस्ट कहते हैं।"
  },
  {
    id: 13,
    question: "18 : 30 :: 36 : ?",
    options: ["64", "66", "54", "62"],
    correctAnswer: "66",
    logic: "Logic: (n × 2) - 6. (18×2)-6 = 30. (36×2)-6 = 66."
  },
  {
    id: 14,
    question: "शीतलता : शीतलक :: ? : ? ",
    options: ["आर्द्रता : थर्मामीटर", "दबाव : बैरोमीटर", "मोटाई : कैलिपर", "गर्मी : हीटर"],
    correctAnswer: "गर्मी : हीटर",
    logic: "शीतलक शीतलता प्रदान करता है, हीटर गर्मी प्रदान करता है।"
  },
  {
    id: 15,
    question: "MK : 169/121 :: JH : ?",
    options: ["100/64", "100/81", "81/64", "64/100"],
    correctAnswer: "100/64",
    logic: "स्थान का वर्ग। M=13²=169, K=11²=121. J=10²=100, H=8²=64."
  },
  {
    id: 16,
    question: "बाघ : फेलिडाई (Felidae) :: खरगोश : ?",
    options: ["लेपोरिडे", "कैनिडे", "बोविडे", "इक्विडे"],
    correctAnswer: "लेपोरिडे",
    logic: "खरगोश लेपोरिडे परिवार से है।"
  },
  {
    id: 17,
    question: "42 : 56 :: 72 : ?",
    options: ["81", "90", "92", "100"],
    correctAnswer: "90",
    logic: "क्रमिक संख्या गुणन। 6×7, 7×8... 8×9, 9×10=90."
  },
  {
    id: 18,
    question: "विजय : प्रोत्साहन :: विफलता : ?",
    options: ["उदासी", "हताशा (Frustration)", "क्रोध", "चिंता"],
    correctAnswer: "हताशा (Frustration)",
    logic: "विजय से प्रोत्साहन, विफलता से हताशा।"
  },
  {
    id: 19,
    question: "AZCX : BYDW :: HQJO : ?",
    options: ["GRFP", "IPKN", "GREP", "ISKP"],
    correctAnswer: "IPKN",
    logic: "+1, -1 पैटर्न। A+1=B, Z-1=Y... H+1=I, Q-1=P, J+1=K, O-1=N."
  },
  {
    id: 20,
    question: "पाइरोफोबिया : आग :: ओक्लोफोबिया : ?",
    options: ["भीड़ (Crowd)", "ऊंचाई", "अंधेरा", "विदेशी"],
    correctAnswer: "भीड़ (Crowd)",
    logic: "पाइरोफोबिया आग का डर, ओक्लोफोबिया भीड़ का डर।"
  }
];

// --- Main App Component ---
export default function App() {
  const [gameState, setGameState] = useState('start'); // start, quiz, result
  const [currentQIndex, setCurrentQIndex] = useState(0);
  const [answers, setAnswers] = useState({});
  const [timeLeft, setTimeLeft] = useState(1200); // 20 minutes in seconds
  const [showLogic, setShowLogic] = useState(false);

  // Timer Logic
  useEffect(() => {
    let interval = null;
    if (gameState === 'quiz' && timeLeft > 0) {
      interval = setInterval(() => {
        setTimeLeft((prev) => prev - 1);
      }, 1000);
    } else if (timeLeft === 0 && gameState === 'quiz') {
      setGameState('result');
    }
    return () => clearInterval(interval);
  }, [gameState, timeLeft]);

  // Handlers
  const handleStart = () => {
    setGameState('quiz');
    setTimeLeft(1200);
    setCurrentQIndex(0);
    setAnswers({});
    setShowLogic(false);
  };

  const handleAnswer = (option) => {
    const qId = QUESTIONS[currentQIndex].id;
    setAnswers({ ...answers, [qId]: option });
  };

  const handleNext = () => {
    if (currentQIndex < QUESTIONS.length - 1) {
      setCurrentQIndex((prev) => prev + 1);
    }
  };

  const handlePrev = () => {
    if (currentQIndex > 0) {
      setCurrentQIndex((prev) => prev - 1);
    }
  };

  const handleSubmit = () => {
    setGameState('result');
  };

  const formatTime = (seconds) => {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m}:${s < 10 ? '0' : ''}${s}`;
  };

  const calculateResults = () => {
    let correct = 0;
    let wrong = 0;
    let skipped = 0;

    QUESTIONS.forEach((q) => {
      const ans = answers[q.id];
      if (!ans) {
        skipped++;
      } else if (ans === q.correctAnswer) {
        correct++;
      } else {
        wrong++;
      }
    });

    // 1 mark for correct, 1/3 deduction for wrong
    const score = (correct * 1) - (wrong * (1 / 3));
    return { correct, wrong, skipped, score: score.toFixed(2) };
  };

  // --- Render Screens ---

  // 1. Start Screen
  if (gameState === 'start') {
    return (
      <div className="min-h-screen bg-black text-white flex flex-col items-center justify-center p-4 font-sans selection:bg-cyan-500 selection:text-black">
        {/* Background Elements */}
        <div className="fixed inset-0 pointer-events-none">
           <div className="absolute top-0 left-0 w-96 h-96 bg-purple-900/20 rounded-full blur-3xl"></div>
           <div className="absolute bottom-0 right-0 w-96 h-96 bg-cyan-900/20 rounded-full blur-3xl"></div>
        </div>

        <div className="relative z-10 max-w-2xl w-full bg-gray-900/80 border border-gray-800 rounded-2xl p-8 md:p-12 text-center shadow-2xl backdrop-blur-md">
          <div className="inline-flex p-4 rounded-full bg-cyan-900/20 mb-6 border border-cyan-500/30">
            <Zap className="w-12 h-12 text-cyan-400" />
          </div>
          
          <h1 className="text-4xl md:text-6xl font-extrabold mb-4 tracking-tight">
            <span className="text-white">ANALOGY</span> <span className="text-cyan-400">MASTER</span>
          </h1>
          
          <p className="text-gray-400 text-lg mb-10">
            High Level Reasoning • Negative Marking • Time Pressure
          </p>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10">
            <div className="bg-gray-800/50 p-4 rounded-xl border border-gray-700">
              <Clock className="mx-auto mb-2 text-yellow-400" />
              <div className="font-bold text-xl">20 Min</div>
              <div className="text-xs text-gray-500 uppercase">Limit</div>
            </div>
            <div className="bg-gray-800/50 p-4 rounded-xl border border-gray-700">
              <Award className="mx-auto mb-2 text-purple-400" />
              <div className="font-bold text-xl">20 Qs</div>
              <div className="text-xs text-gray-500 uppercase">Hard</div>
            </div>
            <div className="bg-gray-800/50 p-4 rounded-xl border border-gray-700">
              <XCircle className="mx-auto mb-2 text-red-400" />
              <div className="font-bold text-xl">-0.33</div>
              <div className="text-xs text-gray-500 uppercase">Negative</div>
            </div>
          </div>

          <button 
            onClick={handleStart}
            className="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-4 rounded-xl shadow-[0_0_20px_rgba(6,182,212,0.4)] transition-transform hover:scale-[1.02] flex items-center justify-center gap-2 text-lg"
          >
            START CHALLENGE <Play size={20} fill="currentColor" />
          </button>
        </div>
      </div>
    );
  }

  // 2. Quiz Screen
  if (gameState === 'quiz') {
    const currentQ = QUESTIONS[currentQIndex];
    const progress = ((currentQIndex + 1) / QUESTIONS.length) * 100;
    
    return (
      <div className="min-h-screen bg-black text-white flex flex-col font-sans">
        {/* Header */}
        <header className="bg-gray-900 border-b border-gray-800 sticky top-0 z-20">
          <div className="max-w-5xl mx-auto px-4 h-16 flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className="bg-gray-800 px-3 py-1 rounded text-cyan-400 font-bold border border-gray-700">
                Q{currentQIndex + 1}
              </div>
              <span className="text-gray-500 text-sm hidden md:inline">of {QUESTIONS.length} Questions</span>
            </div>
            
            <div className={`flex items-center gap-2 font-mono text-xl font-bold px-4 py-1 rounded ${timeLeft < 60 ? 'bg-red-900/20 text-red-500 border border-red-500/30' : 'bg-gray-800 text-cyan-400 border border-gray-700'}`}>
              <Clock size={18} />
              {formatTime(timeLeft)}
            </div>
          </div>
          {/* Progress Bar */}
          <div className="h-1 w-full bg-gray-800">
            <div className="h-full bg-cyan-500 transition-all duration-300" style={{ width: `${progress}%` }}></div>
          </div>
        </header>

        {/* Question Area */}
        <main className="flex-1 flex flex-col justify-center items-center p-4">
          <div className="w-full max-w-4xl">
            <div className="bg-gray-900/50 border border-gray-800 rounded-3xl p-6 md:p-10 shadow-2xl backdrop-blur-sm">
              <h2 className="text-2xl md:text-4xl font-bold text-white mb-8 leading-snug">
                {currentQ.question}
              </h2>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {currentQ.options.map((option, idx) => {
                  const isSelected = answers[currentQ.id] === option;
                  return (
                    <button
                      key={idx}
                      onClick={() => handleAnswer(option)}
                      className={`relative p-5 text-left rounded-xl border-2 transition-all duration-200 group
                        ${isSelected 
                          ? 'border-cyan-500 bg-cyan-900/20 text-white shadow-[0_0_15px_rgba(6,182,212,0.2)]' 
                          : 'border-gray-800 bg-gray-800/50 text-gray-400 hover:border-gray-600 hover:bg-gray-800 hover:text-white'
                        }
                      `}
                    >
                      <div className="flex justify-between items-center">
                        <span className="text-lg font-medium">{option}</span>
                        <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center
                          ${isSelected ? 'border-cyan-400' : 'border-gray-600 group-hover:border-gray-400'}`}>
                            {isSelected && <div className="w-2.5 h-2.5 bg-cyan-400 rounded-full"></div>}
                        </div>
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>
        </main>

        {/* Footer Nav */}
        <footer className="bg-gray-900 border-t border-gray-800 p-4">
          <div className="max-w-5xl mx-auto flex justify-between items-center">
            <button
              onClick={handlePrev}
              disabled={currentQIndex === 0}
              className={`flex items-center gap-2 px-6 py-3 rounded-lg font-bold transition-colors
                ${currentQIndex === 0 ? 'text-gray-600 cursor-not-allowed' : 'text-gray-300 hover:bg-gray-800 hover:text-white'}`}
            >
              <ArrowLeft size={18} /> Previous
            </button>

            {currentQIndex === QUESTIONS.length - 1 ? (
              <button
                onClick={handleSubmit}
                className="flex items-center gap-2 px-8 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg font-bold shadow-lg transition-transform hover:scale-105"
              >
                Submit Test <CheckCircle size={18} />
              </button>
            ) : (
              <button
                onClick={handleNext}
                className="flex items-center gap-2 px-8 py-3 bg-white text-black hover:bg-gray-200 rounded-lg font-bold shadow-lg transition-transform hover:scale-105"
              >
                Next <ArrowRight size={18} />
              </button>
            )}
          </div>
        </footer>
      </div>
    );
  }

  // 3. Result Screen
  if (gameState === 'result') {
    const stats = calculateResults();
    const isPass = parseFloat(stats.score) > 10;

    return (
      <div className="min-h-screen bg-black text-white font-sans p-4 md:p-8 overflow-y-auto">
        <div className="max-w-5xl mx-auto">
          
          {/* Score Card */}
          <div className="bg-gray-900 border border-gray-800 rounded-3xl p-8 mb-8 text-center relative overflow-hidden">
             {/* Pass/Fail Top Border */}
             <div className={`absolute top-0 left-0 w-full h-2 ${isPass ? 'bg-emerald-500' : 'bg-red-500'}`}></div>
             
             <h2 className="text-gray-400 font-bold uppercase tracking-widest text-sm mb-4">Final Result</h2>
             <div className="text-7xl font-extrabold mb-2 text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-400">
               {stats.score}
             </div>
             <div className="text-gray-500 mb-8 font-medium">Out of 20.00</div>

             <div className="flex justify-center gap-6 md:gap-12 mb-8">
               <div className="text-center">
                 <div className="text-3xl font-bold text-emerald-400">{stats.correct}</div>
                 <div className="text-xs text-gray-500 uppercase mt-1">Correct</div>
               </div>
               <div className="text-center">
                 <div className="text-3xl font-bold text-red-400">{stats.wrong}</div>
                 <div className="text-xs text-gray-500 uppercase mt-1">Wrong</div>
               </div>
               <div className="text-center">
                 <div className="text-3xl font-bold text-gray-400">{stats.skipped}</div>
                 <div className="text-xs text-gray-500 uppercase mt-1">Skipped</div>
               </div>
             </div>

             <div className="flex flex-col md:flex-row justify-center gap-4">
               <button 
                 onClick={() => window.location.reload()}
                 className="flex items-center justify-center gap-2 px-6 py-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-white font-bold transition-all"
               >
                 <RefreshCw size={18} /> Restart Test
               </button>
               <button 
                 onClick={() => setShowLogic(!showLogic)}
                 className="flex items-center justify-center gap-2 px-6 py-3 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white font-bold transition-all"
               >
                 {showLogic ? 'Hide Explanations' : 'Show Explanations'}
               </button>
             </div>
          </div>

          {/* Analysis Section */}
          {showLogic && (
            <div className="space-y-4 animate-in fade-in duration-500">
              <h3 className="text-xl font-bold text-white mb-4 pl-2 border-l-4 border-cyan-500">Detailed Analysis</h3>
              {QUESTIONS.map((q, idx) => {
                const ans = answers[q.id];
                const isCorrect = ans === q.correctAnswer;
                const isSkipped = !ans;

                return (
                  <div key={idx} className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                    <div className="flex gap-4">
                      <div className={`w-8 h-8 flex-shrink-0 flex items-center justify-center rounded font-bold text-sm
                        ${isCorrect ? 'bg-emerald-900/30 text-emerald-400 border border-emerald-500/30' : 
                          isSkipped ? 'bg-gray-800 text-gray-400 border border-gray-700' : 
                          'bg-red-900/30 text-red-400 border border-red-500/30'}`}>
                        {idx + 1}
                      </div>
                      
                      <div className="flex-1">
                        <p className="text-lg font-medium text-gray-200 mb-3">{q.question}</p>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3 text-sm">
                           <div>
                             <span className="text-gray-500 block text-xs uppercase font-bold mb-1">Your Answer</span>
                             <span className={`${isCorrect ? 'text-emerald-400' : isSkipped ? 'text-gray-400' : 'text-red-400'} font-bold`}>
                               {ans || "Skipped"}
                             </span>
                           </div>
                           {!isCorrect && (
                             <div>
                               <span className="text-gray-500 block text-xs uppercase font-bold mb-1">Correct Answer</span>
                               <span className="text-cyan-400 font-bold">{q.correctAnswer}</span>
                             </div>
                           )}
                        </div>

                        <div className="pt-3 border-t border-gray-800 flex gap-2 items-start text-sm text-gray-300">
                          <Zap size={16} className="text-yellow-400 flex-shrink-0 mt-0.5" />
                          <p>{q.logic}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          )}

        </div>
      </div>
    );
  }

  return null;
}
